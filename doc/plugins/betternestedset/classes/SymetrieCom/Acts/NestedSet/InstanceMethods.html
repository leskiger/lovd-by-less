<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: SymetrieCom::Acts::NestedSet::InstanceMethods</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">SymetrieCom::Acts::NestedSet::InstanceMethods</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/vendor/plugins/betternestedset/lib/better_nested_set_rb.html">
                vendor/plugins/betternestedset/lib/better_nested_set.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This module provides instance methods for an enhanced acts_as_nested_set
mixin. Please see the README for background information, examples, and tips
on usage.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000009">&lt;=&gt;</a>&nbsp;&nbsp;
      <a href="#M000031">add_child</a>&nbsp;&nbsp;
      <a href="#M000023">all_children</a>&nbsp;&nbsp;
      <a href="#M000021">all_children_count</a>&nbsp;&nbsp;
      <a href="#M000016">ancestors</a>&nbsp;&nbsp;
      <a href="#M000007">before_create</a>&nbsp;&nbsp;
      <a href="#M000008">before_destroy</a>&nbsp;&nbsp;
      <a href="#M000029">check_full_tree</a>&nbsp;&nbsp;
      <a href="#M000028">check_subtree</a>&nbsp;&nbsp;
      <a href="#M000011">child?</a>&nbsp;&nbsp;
      <a href="#M000024">children</a>&nbsp;&nbsp;
      <a href="#M000025">direct_children</a>&nbsp;&nbsp;
      <a href="#M000022">full_set</a>&nbsp;&nbsp;
      <a href="#M000026">leaves</a>&nbsp;&nbsp;
      <a href="#M000027">leaves_count</a>&nbsp;&nbsp;
      <a href="#M000020">level</a>&nbsp;&nbsp;
      <a href="#M000034">move_to_child_of</a>&nbsp;&nbsp;
      <a href="#M000032">move_to_left_of</a>&nbsp;&nbsp;
      <a href="#M000033">move_to_right_of</a>&nbsp;&nbsp;
      <a href="#M000015">parent</a>&nbsp;&nbsp;
      <a href="#M000030">renumber_full_tree</a>&nbsp;&nbsp;
      <a href="#M000013">root</a>&nbsp;&nbsp;
      <a href="#M000010">root?</a>&nbsp;&nbsp;
      <a href="#M000014">roots</a>&nbsp;&nbsp;
      <a href="#M000017">self_and_ancestors</a>&nbsp;&nbsp;
      <a href="#M000019">self_and_siblings</a>&nbsp;&nbsp;
      <a href="#M000018">siblings</a>&nbsp;&nbsp;
      <a href="#M000012">unknown?</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">&lt;=&gt;</span><span class="method-args">(x)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
By default, records are compared and sorted using the left column.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 175</span>
175:         <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;=&gt;</span>(<span class="ruby-identifier">x</span>)
176:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-identifier">left_col_name</span>]
177:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000031" class="method-detail">
        <a name="M000031"></a>

        <div class="method-heading">
          <a href="#M000031" class="method-signature">
          <span class="method-name">add_child</span><span class="method-args">(child)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Adds a child to this object in the tree. If this object
hasn&#8216;t been initialized, it gets set up as a <a
href="InstanceMethods.html#M000013">root</a> node.
</p>
<p>
This method exists only for compatibility and will be removed in future
versions.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000031-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000031-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 332</span>
332:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_child</span>(<span class="ruby-identifier">child</span>)
333:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
334:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>; <span class="ruby-identifier">child</span>.<span class="ruby-identifier">reload</span> <span class="ruby-comment cmt"># for compatibility with old version</span>
335:             <span class="ruby-comment cmt"># the old version allows records with nil values for lft and rgt</span>
336:             <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>]
337:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">right_col_name</span>]
338:                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>, <span class="ruby-value str">&quot;If parent lft or rgt are nil, you can't add a child with non-nil lft or rgt&quot;</span>
339:               <span class="ruby-keyword kw">end</span>
340:               <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = CASE \
341:                                           WHEN id = #{self.id} \
342:                                             THEN 1 \
343:                                           WHEN id = #{child.id} \
344:                                             THEN 3 \
345:                                           ELSE #{left_col_name} END, \
346:                                      #{right_col_name} = CASE \
347:                                           WHEN id = #{self.id} \
348:                                             THEN 2 \
349:                                           WHEN id = #{child.id} \
350:                                             THEN 4 \
351:                                          ELSE #{right_col_name} END&quot;</span>,
352:                                       <span class="ruby-identifier">scope_condition</span>)
353:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>; <span class="ruby-identifier">child</span>.<span class="ruby-identifier">reload</span>
354:             <span class="ruby-keyword kw">end</span>
355:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">right_col_name</span>]
356:               <span class="ruby-identifier">maxright</span> = <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">right_col_name</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope_condition</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
357:               <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = CASE \
358:                                           WHEN id = #{child.id} \
359:                                             THEN #{maxright + 1} \
360:                                           ELSE #{left_col_name} END, \
361:                                       #{right_col_name} = CASE \
362:                                           WHEN id = #{child.id} \
363:                                             THEN #{maxright + 2} \
364:                                           ELSE #{right_col_name} END&quot;</span>,
365:                                       <span class="ruby-identifier">scope_condition</span>)
366:               <span class="ruby-identifier">child</span>.<span class="ruby-identifier">reload</span>
367:             <span class="ruby-keyword kw">end</span>
368:             
369:             <span class="ruby-identifier">child</span>.<span class="ruby-identifier">move_to_child_of</span>(<span class="ruby-keyword kw">self</span>)
370:             <span class="ruby-comment cmt"># self.reload ## even though move_to calls target.reload, at least one object in the tests was not reloading (near the end of test_common_usage)</span>
371:           <span class="ruby-keyword kw">end</span>
372:         <span class="ruby-comment cmt"># self.reload</span>
373:         <span class="ruby-comment cmt"># child.reload</span>
374:         <span class="ruby-comment cmt">#</span>
375:         <span class="ruby-comment cmt"># if child.root?</span>
376:         <span class="ruby-comment cmt">#   raise ActiveRecord::ActiveRecordError, &quot;Adding sub-tree isn\'t currently supported&quot;</span>
377:         <span class="ruby-comment cmt"># else</span>
378:         <span class="ruby-comment cmt">#   if ( (self[left_col_name] == nil) || (self[right_col_name] == nil) )</span>
379:         <span class="ruby-comment cmt">#     # Looks like we're now the root node!  Woo</span>
380:         <span class="ruby-comment cmt">#     self[left_col_name] = 1</span>
381:         <span class="ruby-comment cmt">#     self[right_col_name] = 4</span>
382:         <span class="ruby-comment cmt">#     </span>
383:         <span class="ruby-comment cmt">#     # What do to do about validation?</span>
384:         <span class="ruby-comment cmt">#     return nil unless self.save</span>
385:         <span class="ruby-comment cmt">#     </span>
386:         <span class="ruby-comment cmt">#     child[parent_col_name] = self.id</span>
387:         <span class="ruby-comment cmt">#     child[left_col_name] = 2</span>
388:         <span class="ruby-comment cmt">#     child[right_col_name]= 3</span>
389:         <span class="ruby-comment cmt">#     return child.save</span>
390:         <span class="ruby-comment cmt">#   else</span>
391:         <span class="ruby-comment cmt">#     # OK, we need to add and shift everything else to the right</span>
392:         <span class="ruby-comment cmt">#     child[parent_col_name] = self.id</span>
393:         <span class="ruby-comment cmt">#     right_bound = self[right_col_name]</span>
394:         <span class="ruby-comment cmt">#     child[left_col_name] = right_bound</span>
395:         <span class="ruby-comment cmt">#     child[right_col_name] = right_bound + 1</span>
396:         <span class="ruby-comment cmt">#     self[right_col_name] += 2</span>
397:         <span class="ruby-comment cmt">#     self.class.transaction {</span>
398:         <span class="ruby-comment cmt">#       self.class.update_all( &quot;#{left_col_name} = (#{left_col_name} + 2)&quot;,  &quot;#{scope_condition} AND #{left_col_name} &gt;= #{right_bound}&quot; )</span>
399:         <span class="ruby-comment cmt">#       self.class.update_all( &quot;#{right_col_name} = (#{right_col_name} + 2)&quot;,  &quot;#{scope_condition} AND #{right_col_name} &gt;= #{right_bound}&quot; )</span>
400:         <span class="ruby-comment cmt">#       self.save</span>
401:         <span class="ruby-comment cmt">#       child.save</span>
402:         <span class="ruby-comment cmt">#     }</span>
403:         <span class="ruby-comment cmt">#   end</span>
404:         <span class="ruby-comment cmt"># end</span>
405:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">all_children</span><span class="method-args">(special=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all <a href="InstanceMethods.html#M000024">children</a> and nested
<a href="InstanceMethods.html#M000024">children</a>. Pass :exclude =&gt;
item, or id, or [items or id] to exclude one or more items <b>and</b> all
of their descendants.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 261</span>
261:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_children</span>(<span class="ruby-identifier">special</span>=<span class="ruby-keyword kw">nil</span>)
262:           <span class="ruby-identifier">full_set</span>(<span class="ruby-identifier">special</span>) <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
263:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">all_children_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the number of nested <a
href="InstanceMethods.html#M000024">children</a> of this object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 244</span>
244:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_children_count</span>
245:           <span class="ruby-keyword kw">return</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)<span class="ruby-operator">/</span><span class="ruby-value">2</span>
246:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">ancestors</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of all parents, starting with the <a
href="InstanceMethods.html#M000013">root</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 214</span>
214:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestors</span>
215:           <span class="ruby-identifier">self_and_ancestors</span> <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
216:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">before_create</span><span class="method-args">(</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
On creation, automatically add the new node to the right of all existing
nodes in this tree.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 153</span>
153:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_create</span> <span class="ruby-comment cmt"># already protected by a transaction</span>
154:           <span class="ruby-identifier">maxright</span> = <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">right_col_name</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope_condition</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
155:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] = <span class="ruby-identifier">maxright</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
156:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] = <span class="ruby-identifier">maxright</span><span class="ruby-operator">+</span><span class="ruby-value">2</span>
157:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">before_destroy</span><span class="method-args">(</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
On destruction, delete all <a
href="InstanceMethods.html#M000024">children</a> and shift the lft/rgt
values back to the left so the counts still work.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 160</span>
160:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_destroy</span> <span class="ruby-comment cmt"># already protected by a transaction</span>
161:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>].<span class="ruby-identifier">nil?</span>
162:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span> <span class="ruby-comment cmt"># in case a concurrent move has altered the indexes</span>
163:           <span class="ruby-identifier">dif</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
164:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">delete_all</span>( <span class="ruby-node">&quot;#{scope_condition} AND (#{left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]})&quot;</span> )
165:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = CASE \
166:                                       WHEN #{left_col_name} &gt; #{self[right_col_name]} THEN (#{left_col_name} - #{dif}) \
167:                                       ELSE #{left_col_name} END, \
168:                                  #{right_col_name} = CASE \
169:                                       WHEN #{right_col_name} &gt; #{self[right_col_name]} THEN (#{right_col_name} - #{dif} ) \
170:                                       ELSE #{right_col_name} END&quot;</span>,
171:                                  <span class="ruby-identifier">scope_condition</span>)
172:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="#M000029" class="method-signature">
          <span class="method-name">check_full_tree</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks the left/right indexes of the entire tree that this node belongs to,
returning the number of records checked. Throws
ActiveRecord::ActiveRecordError if it finds a problem. This method is
needed because <a href="InstanceMethods.html#M000028">check_subtree</a>
alone cannot find gaps between virtual <a
href="InstanceMethods.html#M000014">roots</a>, orphaned nodes or endless
loops.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000029-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000029-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 295</span>
295:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_full_tree</span>
296:           <span class="ruby-identifier">total_nodes</span> = <span class="ruby-value">0</span>
297:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
298:             <span class="ruby-comment cmt"># virtual roots make this method more complex than it otherwise would be</span>
299:             <span class="ruby-identifier">n</span> = <span class="ruby-value">1</span>
300:             <span class="ruby-identifier">roots</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> 
301:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>, <span class="ruby-node">&quot;Gaps between roots in the tree containing record ##{r.id}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">n</span>
302:               <span class="ruby-identifier">r</span>.<span class="ruby-identifier">check_subtree</span>
303:               <span class="ruby-identifier">n</span> = <span class="ruby-identifier">r</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
304:             <span class="ruby-keyword kw">end</span>
305:             <span class="ruby-identifier">total_nodes</span> = <span class="ruby-identifier">roots</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-value">0</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">sum</span>, <span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sum</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">all_children_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> }
306:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition}&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">total_nodes</span>
307:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>, <span class="ruby-node">&quot;Orphaned nodes or endless loops in the tree containing record ##{self.id}&quot;</span>
308:             <span class="ruby-keyword kw">end</span>
309:           <span class="ruby-keyword kw">end</span>
310:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">total_nodes</span>
311:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="#M000028" class="method-signature">
          <span class="method-name">check_subtree</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks the left/right indexes of one node and all descendants. Throws
ActiveRecord::ActiveRecordError if it finds a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000028-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000028-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 285</span>
285:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_subtree</span>
286:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
287:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>
288:             <span class="ruby-identifier">check</span> <span class="ruby-comment cmt"># this method is implemented via #check, so that we don't generate lots of unnecessary nested transactions</span>
289:           <span class="ruby-keyword kw">end</span>
290:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">child?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Returns true if this is a child node
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 186</span>
186:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">child?</span>                          
187:           <span class="ruby-identifier">parent_id</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]
188:           <span class="ruby-operator">!</span>(<span class="ruby-identifier">parent_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>])
189:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">children</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s immediate <a
href="InstanceMethods.html#M000024">children</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 266</span>
266:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children</span>
267:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND #{parent_col_name} = #{self.id}&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">left_col_name</span>)
268:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <span class="method-name">direct_children</span><span class="method-args">()</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="InstanceMethods.html#M000024">children</a>
</p>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">full_set</span><span class="method-args">(special=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns itself and all nested <a
href="InstanceMethods.html#M000024">children</a>. Pass :exclude =&gt; item,
or id, or [items or id] to exclude one or more items <b>and</b> all of
their descendants.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 250</span>
250:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">full_set</span>(<span class="ruby-identifier">special</span>=<span class="ruby-keyword kw">nil</span>)
251:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">special</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">special</span>[<span class="ruby-identifier">:exclude</span>]
252:             <span class="ruby-identifier">exclude_str</span> = <span class="ruby-node">&quot; AND NOT (#{base_set_class.sql_for(special[:exclude])}) &quot;</span>
253:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
254:             <span class="ruby-keyword kw">return</span> [<span class="ruby-keyword kw">self</span>]
255:           <span class="ruby-keyword kw">end</span>
256:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} #{exclude_str} AND (#{left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]})&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">left_col_name</span>)
257:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000026" class="method-detail">
        <a name="M000026"></a>

        <div class="method-heading">
          <a href="#M000026" class="method-signature">
          <span class="method-name">leaves</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s terminal <a
href="InstanceMethods.html#M000024">children</a> (nodes without <a
href="InstanceMethods.html#M000024">children</a>).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000026-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000026-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 274</span>
274:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leaves</span>
275:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]}) AND #{left_col_name} + 1 = #{right_col_name}&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">left_col_name</span>)
276:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="#M000027" class="method-signature">
          <span class="method-name">leaves_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the count of this record&#8216;s terminal <a
href="InstanceMethods.html#M000024">children</a> (nodes without <a
href="InstanceMethods.html#M000024">children</a>).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000027-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000027-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 279</span>
279:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leaves_count</span>
280:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]}) AND #{left_col_name} + 1 = #{right_col_name}&quot;</span>)
281:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">level</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="InstanceMethods.html#M000020">level</a> of this object
in the tree, <a href="InstanceMethods.html#M000013">root</a> <a
href="InstanceMethods.html#M000020">level</a> being 0.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 238</span>
238:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">level</span>
239:           <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">nil?</span>
240:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{self[left_col_name]} BETWEEN #{left_col_name} AND #{right_col_name})&quot;</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
241:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000034" class="method-detail">
        <a name="M000034"></a>

        <div class="method-heading">
          <a href="#M000034" class="method-signature">
          <span class="method-name">move_to_child_of</span><span class="method-args">(target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Make this node a child of <em>target</em> (you can pass an object or just
an id). Unsaved changes in either object will be lost. Raises
ActiveRecord::ActiveRecordError if it encounters a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000034-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000034-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 421</span>
421:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_child_of</span>(<span class="ruby-identifier">target</span>)
422:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">move_to</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">:child</span>
423:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000032" class="method-detail">
        <a name="M000032"></a>

        <div class="method-heading">
          <a href="#M000032" class="method-signature">
          <span class="method-name">move_to_left_of</span><span class="method-args">(target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Move this node to the left of <em>target</em> (you can pass an object or
just an id). Unsaved changes in either object will be lost. Raises
ActiveRecord::ActiveRecordError if it encounters a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000032-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000032-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 409</span>
409:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_left_of</span>(<span class="ruby-identifier">target</span>)
410:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">move_to</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">:left</span>
411:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000033" class="method-detail">
        <a name="M000033"></a>

        <div class="method-heading">
          <a href="#M000033" class="method-signature">
          <span class="method-name">move_to_right_of</span><span class="method-args">(target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Move this node to the right of <em>target</em> (you can pass an object or
just an id). Unsaved changes in either object will be lost. Raises
ActiveRecord::ActiveRecordError if it encounters a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000033-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000033-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 415</span>
415:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_right_of</span>(<span class="ruby-identifier">target</span>)
416:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">move_to</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">:right</span>
417:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">parent</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s <a
href="InstanceMethods.html#M000015">parent</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 209</span>
209:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parent</span>
210:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]
211:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="#M000030" class="method-signature">
          <span class="method-name">renumber_full_tree</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Re-calculate the left/right values of all nodes in this record&#8216;s
tree. Can be used to convert an ordinary tree into a nested set.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000030-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000030-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 314</span>
314:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">renumber_full_tree</span>
315:           <span class="ruby-identifier">indexes</span> = []
316:           <span class="ruby-identifier">n</span> = <span class="ruby-value">1</span>
317:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
318:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">roots</span> <span class="ruby-comment cmt"># because we may have virtual roots</span>
319:               <span class="ruby-identifier">n</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">calc_numbers</span>(<span class="ruby-identifier">n</span>, <span class="ruby-identifier">indexes</span>)
320:             <span class="ruby-keyword kw">end</span>
321:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">indexes</span>
322:               <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = #{i[:lft]}, #{right_col_name} = #{i[:rgt]}&quot;</span>, <span class="ruby-node">&quot;#{self.class.primary_key} = #{i[:id]}&quot;</span>)
323:             <span class="ruby-keyword kw">end</span>
324:           <span class="ruby-keyword kw">end</span>
325:           <span class="ruby-comment cmt">## reload?</span>
326:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">root</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s <a href="InstanceMethods.html#M000013">root</a>
ancestor.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 197</span>
197:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root</span>
198:           <span class="ruby-comment cmt"># the BETWEEN clause is needed to ensure we get the right virtual root, if using those</span>
199:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} \
200:             AND (#{parent_col_name} IS NULL OR #{parent_col_name} = 0) AND (#{self[left_col_name]} BETWEEN #{left_col_name} AND #{right_col_name})&quot;</span>)
201:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">root?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Returns true if this is a <a
href="InstanceMethods.html#M000013">root</a> node.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 180</span>
180:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root?</span>
181:           <span class="ruby-identifier">parent_id</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]
182:           (<span class="ruby-identifier">parent_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>])
183:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">roots</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="InstanceMethods.html#M000013">root</a> or virtual <a
href="InstanceMethods.html#M000014">roots</a> of this record&#8216;s tree
(a tree cannot have more than one real <a
href="InstanceMethods.html#M000013">root</a>). See the explanation of
virtual <a href="InstanceMethods.html#M000014">roots</a> in the README.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 204</span>
204:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">roots</span>
205:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{parent_col_name} IS NULL OR #{parent_col_name} = 0)&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{left_col_name}&quot;</span>)
206:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">self_and_ancestors</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of all parents plus self, starting with the <a
href="InstanceMethods.html#M000013">root</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 219</span>
219:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">self_and_ancestors</span>
220:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{self[left_col_name]} BETWEEN #{left_col_name} AND #{right_col_name})&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">left_col_name</span> )
221:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">self_and_siblings</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all the <a href="InstanceMethods.html#M000024">children</a> of this
node&#8216;s <a href="InstanceMethods.html#M000015">parent</a>, including
self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 229</span>
229:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">self_and_siblings</span>
230:           <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">zero?</span>
231:             [<span class="ruby-keyword kw">self</span>]
232:           <span class="ruby-keyword kw">else</span>
233:             <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND #{parent_col_name} = #{self[parent_col_name]}&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">left_col_name</span>)
234:           <span class="ruby-keyword kw">end</span>
235:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">siblings</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all the <a href="InstanceMethods.html#M000024">children</a> of this
node&#8216;s <a href="InstanceMethods.html#M000015">parent</a>, except
self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 224</span>
224:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">siblings</span>
225:           <span class="ruby-identifier">self_and_siblings</span> <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
226:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">unknown?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Returns true if we have no idea what this is
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File vendor/plugins/betternestedset/lib/better_nested_set.rb, line 192</span>
192:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unknown?</span>
193:           <span class="ruby-operator">!</span><span class="ruby-identifier">root?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">child?</span>
194:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>